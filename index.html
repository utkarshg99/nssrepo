<!DOCTYPE html>
<head>
    <title>User Portal for Waste Bank</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.0/firebase.js"></script>
    <style>
        .container1
        {
            padding-top: 5%;
        }
    </style>
</head>
<body>
    <div class="container1 container">
        <h2>Waste Bank User Portal (WBUP)</h2>
          <div class="form-group">
            <label for="uid">UID:</label>
            <input type="text" class="form-control" id="uid" placeholder="Enter UID" name="uid">
          </div>
          <div class="form-group">
            <label for="amt1">Amount of Hotriculture Waste:</label>
            <input type="text" class="form-control" id="amt1" placeholder="Enter Amount of Hotriculture Waste" name="amt1">
          </div>
          <div class="form-group">
            <label for="amt2">Amount of Hotriculture2 Waste:</label>
            <input type="text" class="form-control" id="amt2" placeholder="Enter Amount of Hotriculture2 Waste" name="amt2">
          </div>
          <div class="form-group">
            <label for="amt3">Amount of Hotriculture3 Waste:</label>
            <input type="text" class="form-control" id="amt3" placeholder="Enter Amount of Hotriculture3 Waste" name="amt3">
          </div>
          <div class="form-group">
            <label for="amt4">Amount of Hotriculture4 Waste:</label>
            <input type="text" class="form-control" id="amt4" placeholder="Enter Amount of Hotriculture4 Waste" name="amt4">
          </div>
        <!-- <label for="wastetype">Select list (select one):</label>
        <select class="form-control" id="wastetype">
        <option>Hotriculture</option>
        <option>Some shit</option>
        <option>some other shit</option>
        <option>some more shit</option>
        </select> -->
        <br>
        <button class="btn btn-primary" onclick="subm()">Submit</button>
    </div>
    <script>
        var config = {
        apiKey: "AIzaSyCdpGZWBzBcAOjnBEU3X8EEZI9N8bkaGns",
        authDomain: "nssproject-cdff3.firebaseapp.com",
        databaseURL: "https://nssproject-cdff3.firebaseio.com",
        projectId: "nssproject-cdff3",
        storageBucket: "nssproject-cdff3.appspot.com",
        messagingSenderId: "970241223832"
        };
        firebase.initializeApp(config);
        function mid(datax){
            return datax;
        }
        function subm()
        {
        var db = firebase.firestore();
        var u=document.getElementById("uid").value;
        var a1=document.getElementById("amt1").value;
        var a2=document.getElementById("amt2").value;
        var a3=document.getElementById("amt3").value;
        var a4=document.getElementById("amt4").value;
        // var w=document.getElementById("wastetype").value;
        if(u=="" || a1=="" || a2=="" || a3=="" || a4=="")
            alert("Please provide data.");
        else
        {
            var dat;
            var docRef = db.collection("data").doc(u);
            var t=docRef.get().then(function(doc) {
            if (doc.exists) {
                updater(doc.data());
            } else {
                updater({exist:false});
            }}).catch(function(error) {
            console.log("Error getting document:", error);})            
        }
        function updater(dat){
            if(dat.exist)
        {
        a1=Number(a1)+Number(dat.amt1);
        a2=Number(a2)+Number(dat.amt2);
        a3=Number(a3)+Number(dat.amt3);
        a4=Number(a4)+Number(dat.amt4);
        var data = {
        uid:u,
        amt1:a1,
        amt2:a2,
        amt3:a3,
        amt4:a4,
        exist:true
        };
        db.collection("data").doc(u).set(data);
        alert("Succesfully submitted. Press F5 or Ctrl+R to make a new entry.");
        }
            else
        {
        alert("User doesn't exist, making new entry...");
        var data = {
        uid:u,
        amt1:a1,
        amt2:a2,
        amt3:a3,
        amt4:a4,
        exist:true
        };
        db.collection("data").doc(u).set(data);
        alert("Succesfully submitted, New entry created. Press F5 or Ctrl+R to make a new entry.");
        }
        }
        }
    </script>
</body>